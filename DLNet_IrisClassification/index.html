<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Iris Flower Classifier</title>
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
    label { display: block; margin-bottom: .5rem; }
    input[type=number] { width: 100%; padding: .5rem; margin-top: .25rem; }
    button { padding: .75rem 1.5rem; margin-top: 1rem; margin-right: .5rem; }
    #status-output, #model-output { margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Iris Flower Classifier</h1>
  <h2>Andrea Salgado and Claudia Pletka</h2>
  <form>
    <label>Sepal Length
      <input type="number" id="sepal_length" placeholder="4.3 – 7.9" required>
    </label>
    <label>Sepal Width
      <input type="number" id="sepal_width" placeholder="2.0 – 4.4" required>
    </label>
    <label>Petal Length
      <input type="number" id="petal_length" placeholder="1.0 – 6.9" required>
    </label>
    <label>Petal Width
      <input type="number" id="petal_width" placeholder="0.1 – 2.5" required>
    </label>
    <button type="button" id="classify-btn">Classify</button>
  </form>
  <p>Current status: <span id="status-output">Loading model…</span></p>
  <div id="model-output"><h3>Prediction:</h3></div>

  <script>
    const statusOutput = document.getElementById('status-output');
    const outputDiv     = document.getElementById('model-output');
    
    const classNames    = ['setosa','virginica','versicolor'];

    let session;
    (async () => {
      try {
        session = await ort.InferenceSession.create('./DLnet_IrisData.onnx');
        statusOutput.textContent = 'Model loaded. Ready.';
      } catch (e) {
        statusOutput.textContent = 'Failed to load model.';
        console.error(e);
      }
    })();

    async function runInference() {
      const raw = [
        parseFloat(document.getElementById('sepal_length').value),
        parseFloat(document.getElementById('sepal_width').value),
        parseFloat(document.getElementById('petal_length').value),
        parseFloat(document.getElementById('petal_width').value)
      ];
      console.log('Raw inputs:', raw);

      const tensor = new ort.Tensor('float32', Float32Array.from(raw), [1, 4]);
      const feeds  = { [session.inputNames[0]]: tensor };

      statusOutput.textContent = 'Running inference…';
      try {
        const results   = await session.run(feeds);
        const outTensor = results[session.outputNames[0]];
        const scores    = Array.from(outTensor.data);
        console.log('Raw logits:', scores);

        const idx  = scores.indexOf(Math.max(...scores));
        const cls  = classNames[idx];

        outputDiv.innerHTML = `
          <hr/>
          <h3>Prediction:</h3>
          <p><strong>${cls}</strong> (class ${idx})</p>
        `;
        statusOutput.textContent = 'Done.';
      } catch (e) {
        statusOutput.textContent = 'Inference error.';
        console.error(e);
      }
    }

    document.getElementById('classify-btn')
            .addEventListener('click', runInference);
  </script>
</body>
</html>
